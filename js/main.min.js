document.addEventListener("DOMContentLoaded",function(){$(".searchTxt").bind("keypress",function(t){if(13==t.keyCode)return vm.SearchFilter(),$(".searchTxt").blur(),!1}),$(".searchTxt").bind("change",function(){vm.SearchFilter(),$(".searchTxt").blur()}),$(".searchBtn").bind("click",function(){vm.SearchFilter(),$(".searchTxt").blur()}),vm.Enter()});var Utility={Random:{Value:function(){return Math.random()},Range:function(t,i){return Math.floor(Math.random()*(i-t+1))+t}},Dictionary:{List:[],Add:function(t){this.Has(t)||(this.List.push(t),this.Save())},Remove:function(t){this.Has(t)&&(this.List=this.List.filter(function(i){return i!==t}),this.Save())},Has:function(t){return-1!=this.List.indexOf(t)},Toggle:function(t){this.Has(t)?this.Remove(t):this.Add(t)},CleanEmpty:function(){this.Remove("")},Save:function(){localStorage.BookMark=this.List.join(",")},Create:function(){return this}}},vm=new Vue({el:"#app",data:{AllStory:[{title:"",content:""}],StoryInx:0,NowDiv:1,NowSide:0,Side:!1,Black:!1,ShowNavTitle:!1,isScrolling:!1,SearchList:[],BookMark:Utility.Dictionary.Create(),SearchString:"",RandomSroty:[],CurrentHref:""},computed:{GetThisStory:function(){if(this.StoryInx>=0)return this.AllStory[this.StoryInx].content.split("<br>")}},methods:{Enter:function(){this.GetData(),window.addEventListener("hashchange",this.HashCheck),this.FreshRandomStory(),void 0==localStorage.BookMark?this.BookMark.List=[]:this.BookMark.List=localStorage.BookMark.split(","),this.BookMark.CleanEmpty(),this.HashCheck(),new ClipboardJS("#CopyBtn")},SearchFilter:function(){var t=[];if(""!=this.SearchString)for(var i=0;i<this.AllStory.length;i++)-1!=this.AllStory[i].title.indexOf(this.SearchString)?t.push(i):-1!=this.AllStory[i].group.indexOf(this.SearchString)&&t.push(i);this.ShowSearchList(t)},ShowSearchList:function(t){this.SearchList=t},HashCheck:function(){this.ChangeInx(this.ParseUrl()),this.CurrentHref=document.location.href},GetHash:function(t){return"#inx-"+t},GetSummary:function(t){return this.AllStory[t].content.substring(0,80).replace(/<br>|<br|<b|</g,"\n")},FreshRandomStory:function(){this.RandomSroty=[];for(;this.RandomSroty.length<3&&!(this.AllStory.length<3);){var t=Utility.Random.Range(0,this.AllStory.length);""!=this.AllStory[t].title&&-1==this.RandomSroty.indexOf(t)&&this.RandomSroty.push(t)}},ChangeInx:function(t){t<0||""!=this.AllStory[t].title&&$(".container").css("opacity",1).animate({opacity:0},300,function(){vm.FreshRandomStory(),vm.StoryInx=t,vm.NowDiv=0,$(".container").css("opacity",0).animate({opacity:1},800),vm.Topit()})},ParseUrl:function(){var t=location.hash;if(-1!=t.indexOf("#")){if("#"!=t){var i=t=t.replace("#","");if("inx-"==i.substr(0,4))return"random"==(i=i.replace("inx-",""))&&(i=Range(0,this.AllStory.length)),i}}else location.hash="#";return-1},SideBox:function(t){this.Black=t,this.Side=t},SideToggle:function(){this.Side=!this.Side,this.SideBox(this.Side)},ToggleBookMark:function(){this.BookMark.Toggle(this.StoryInx)},GetData:function(){$.getJSON({url:"data.json",success:function(t){vm.AllStory=t.story},async:!1})},GetRandomStory:function(){ChangeHash(Utility.Random.Range(0,vm.AllStory.length)),vm.NowDiv=0},ChangeHash:function(t){location.hash="inx-"+t},Topit:function(){this.isScrolling||(this.isScrolling=!0,$("html,body").animate({scrollTop:0},300,function(){vm.isScrolling=!1}))},CopyToClipboard:function(){}}});